# starter-typescript-project

To get started locally, run the following commands from the project root directory:

```
npm install
npm run build
npm run start
```

You can also run the build and files in watch mode, but each command will need to be run in its own shell:
```
npm run build:watch

npm run start:watch
```

[//]: # (.pinkyring=DOCKER)

## Docker

[^1]

Run the project in Docker and then later stop the project:
```
npm run docker:build
npm run docker:run

npm run docker:stop
```

### Dockerfile

A [dockerfile](./Dockerfile) has been added that follows the current best practices: 

- https://snyk.io/blog/10-best-practices-to-containerize-nodejs-web-applications-with-docker/
- https://www.docker.com/blog/9-tips-for-containerizing-your-node-js-application/

### Server Best Practices

If you add a server, you will want to use [Graceful Shutdown](https://www.npmjs.com/package/graceful-sd) to handle stopping connections and whatnot gracefully.

You will also probably want to install OpenTelemetry or some sort of telemetry tool: https://opentelemetry.io/docs/instrumentation/js/getting-started/nodejs/

And add a health monitoring endpoint.

[//]: # (.pinkyring=DOCKER.end)

## Infrastructure

A [docker-compose.infra.yml](./devops/docker-compose.infra.yml) file has been added that can be used to add any docker services (databases, caches, etc) that are needed during development.

The infrastructure can be run and shutdown with the following commands:
```
npm run infra

npm run infra:stop
```

[//]: # (.pinkyring=POSTGRES)

### Relational DB

[^1]

Postgres has been added as the relational database, and [TypeORM](https://typeorm.io/) has been added as the ORM.
[pgAdmin](https://www.pgadmin.org/) has also been added that runs with the infrastructure (user: admin@admin.com, password: root).

The database entities live in the [entities folder](./src/entities/) and seed data can be generated by creating a factory and seeder in the [seed folder](./src/relationalDb/seed/).

The configuration for the database is done in the [config.ts file](./src/relationalDb/config.ts).
The following environment variable configurations can be set (or these defaults can be used during development):

```
PGUSER      = postgres
PGPASSWORD  = postgres
PGHOST      = localhost
PGPORT      = 5432
PGDATABASE  = db

PGHOST_CA_CERT
PGCLIENT_KEY
PGCLIENT_CERT
```

Several npm scripts have been created to help with database tasks (run like `npm run db:create`):

- `db:create` to create the database initially
- `db:seed` to seed the database with some initial data
- `db:migration:generate` to generate a database migration. This is used differently than the other commands. Run like: `npm run db:migration:generate --name=[migration-name]`
- `db:migration:run` to update the database schema
- `db:drop` to drop the database. Use with caution, obviously.

To connect to the database and start using TypeORM:

```
import {AppDataSource, waitForDatabaseConnection} from './relationalDb/appDataSource';
import {DemoEntity} from './entities/demoEntity';

// wait for the database connection to be ready
await waitForDatabaseConnection();

// start using the connection
const allDemoEntities = await AppDataSource.getRepository(DemoEntity).find();
```

[//]: # (.pinkyring=POSTGRES.end)

[^1]: This functionality is removable with [pinkyring](https://www.npmjs.com/package/pinkyring)
